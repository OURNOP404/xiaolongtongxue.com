<!doctype html>
<!--
  Material Design Lite
  Copyright 2015 Google Inc. All rights reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      https://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License
-->
<html lang="en">
<head>
  {{template "header"}}
  <link rel="stylesheet" href="/assets/layouts/gfm.css">
  <title>{{if .Title}}{{.Title}} - {{end}}小龙同学</title>
</head>
<body>
<div class="demo-blog demo-blog--blogpost mdl-layout mdl-js-layout has-drawer is-upgraded">
  <main class="mdl-layout__content">
    <div class="demo-back" id="back">
      <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" title="go back" role="button">
        <i class="material-icons" role="presentation">arrow_back</i>
      </a>
    </div>
    <div class="demo-home">
      <button id="demo-menu-lower-right"
              class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">more_vert</i>
      </button>

      <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect"
          for="demo-menu-lower-right">
        <li class="mdl-menu__item" id="home">首页</li>
        <li class="mdl-menu__item">CC BY 4.0</li>
      </ul>
    </div>
    <div class="demo-blog__posts mdl-grid">
      <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">
        <div class="mdl-card__media mdl-color-text--grey-50" style="{{if .Background}}background-image: url('{{.Background}}'){{end}}">
          <h3>{{.Title}}</h3>
        </div>
        <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
          <div class="minilogo"></div>
          <div>
            <strong>小龙同学</strong>
            <span>{{.Date | daysAgo}} 天前{{if .Location}}, {{.Location}}{{end}}{{if .Weather}}, {{.Weather}}{{end}}</span>
          </div>
          <div class="section-spacer"></div>
          <!-- TODO: impl it, backend!
          <div class="meta__favorites">
            425 <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
          </div>
          <div>
            <i class="material-icons" role="presentation">bookmark</i>
            <span class="visuallyhidden">bookmark</span>
          </div>
          -->
          <div>
            <i class="material-icons" role="presentation">share</i>
            <span class="visuallyhidden">share</span>
          </div>
        </div>
        <article class="mdl-color-text--grey-700 mdl-card__supporting-text markdown-body">
          <!-- content start -->
          {{.Html}}
          <!-- content end -->
        </article>
        <div class="mdl-color-text--primary-contrast mdl-card__supporting-text comments">
          <div class="tags">
            {{range $i, $t := .Tags}}
            {{if gt $i 0}}, {{end}}
            <i class="material-icons" role="presentation">bookmark</i>
            <span class="visuallyhidden">bookmark</span>{{$t}}
            {{end}}
          </div>
          <!--
          <form>
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
              <textarea rows=1 class="mdl-textfield__input" id="comment"></textarea>
              <label for="comment" class="mdl-textfield__label">Join the discussion</label>
            </div>
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
              <i class="material-icons" role="presentation">check</i><span class="visuallyhidden">add comment</span>
            </button>
          </form>
          <div class="comment mdl-color-text--grey-700">
            <header class="comment__header">
              <img src="images/co1.jpg" class="comment__avatar">
              <div class="comment__author">
                <strong>James Splayd</strong>
                <span>2 days ago</span>
              </div>
            </header>
            <div class="comment__text">
              In in culpa nulla elit esse. Ex cillum enim aliquip sit sit ullamco ex eiusmod fugiat. Cupidatat ad minim officia mollit laborum magna dolor tempor cupidatat mollit. Est velit sit ad aliqua ullamco laborum excepteur dolore proident incididunt in labore elit.
            </div>
            <nav class="comment__actions">
              <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                <i class="material-icons" role="presentation">thumb_up</i><span class="visuallyhidden">like comment</span>
              </button>
              <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                <i class="material-icons" role="presentation">thumb_down</i><span class="visuallyhidden">dislike comment</span>
              </button>
              <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                <i class="material-icons" role="presentation">share</i><span class="visuallyhidden">share comment</span>
              </button>
            </nav>
            <div class="comment__answers">
              <div class="comment">
                <header class="comment__header">
                  <img src="images/co2.jpg" class="comment__avatar">
                  <div class="comment__author">
                    <strong>John Dufry</strong>
                    <span>2 days ago</span>
                  </div>
                </header>
                <div class="comment__text">
                  Yep, agree!
                </div>
                <nav class="comment__actions">
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                    <i class="material-icons" role="presentation">thumb_up</i><span class="visuallyhidden">like comment</span>
                  </button>
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                    <i class="material-icons" role="presentation">thumb_down</i><span class="visuallyhidden">dislike comment</span>
                  </button>
                  <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
                    <i class="material-icons" role="presentation">share</i><span class="visuallyhidden">share comment</span>
                  </button>
                </nav>
              </div>
            </div>
          </div>
          -->
        </div>
      </div>

      <nav class="demo-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
        <a class="demo-nav__button">
          <button
              id="prev" me="{{.Id}}"
              class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900"
              role="presentation">
            <i class="material-icons">arrow_back</i>
          </button>
          上一篇
        </a>
        <div class="section-spacer"></div>
        <a class="demo-nav__button">
          下一篇
          <button
              id="next" me="{{.Id}}"
              class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900"
              role="presentation">
            <i class="material-icons">arrow_forward</i>
          </button>
        </a>
      </nav>
    </div>
    {{template "footer"}}
  </main>
  <div class="mdl-layout__obfuscator"></div>
</div>
{{template "script"}}
<script type="application/javascript">
  var prev = document.getElementById('prev');
  var next = document.getElementById('next');
  var toast = document.getElementById('toast');

  if (window.history.length > 1) {
    document.getElementById('back').addEventListener('click', function () {
      window.history.back();
    });
  } else {
    document.getElementById('back').style.display = 'none';
  }

  document.getElementById('home').addEventListener('click', function () {
    window.open(window.location.protocol + '//' + window.location.host, "_self");
  });

  prev.addEventListener('click', function () {
    var me = prev.getAttribute('me');
    go(me, -1);
  });

  next.addEventListener('click', function () {
    var me = next.getAttribute('me');
    go(me, 1);
  });

  function go(me, inc) {
    ajax(
        'GET',
        '/articles/inc?inc=' + inc + '&me=' + me,
        function (m) {
          console.log(m);
          window.open(window.location.protocol + '//' + window.location.host + m.id, '_self');
        },
        function (statusCode) {
          console.log(statusCode);
          var msg;
          if (statusCode == 404) {
            if (inc > 0) {
              msg = '没有下一篇了';
            } else {
              msg = '没有上一篇了';
            }
          } else {
            msg = '出错了: ' + statusCode;
          }
          toast.MaterialSnackbar.showSnackbar({message: msg});
        }
    );
  }
</script>
</body>
</html>
